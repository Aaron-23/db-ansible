#!/bin/bash
#====================================================
# Author: Mr.Zhang
# Create Date: 2019-11-13
# Description: auto config MySQL master&slave
#====================================================

cat > /data/slave.sh <<- END
#!/bin/bash
MYSQL_PASSWORD=""
MASTER_HOST="192.168.31.135"
SLAVE_HOST="192.168.31.136"
SYNC_USER="slave"
SYNC_USER_PASS="Gr123465!"

cat > /data/slave.sql <<- EOF
DROP DATABASE IF EXISTS test;
DELETE FROM mysql.db WHERE Db='test' OR Db='test\\\\_%';
DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');
change master to master_host='$MASTER_HOST',master_user='$SYNC_USER',master_password='$SYNC_USER_PASS',master_auto_position=1;
start slave;
FLUSH PRIVILEGES;
EOF
mysql -uroot  < /data/slave.sql
mysql  -e 'show slave status\G'|grep Slave
END

